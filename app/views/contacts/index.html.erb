<% content_for :title, "Contacts" %>
<% content_for :page_header do %>
  <h2 class="font-semibold">Contacts</h2>
<% end %>

<% content_for :header_action_buttons do %>
    <%= link_to "New contact", new_contact_path,
                  class: "btn btn--primary",
                  data: { turbo_frame: "modal" } %>
<% end %>

<div class="flex flex-col p-4 i-full">
  <!--<div class="flex items-center justify-between mbe-4 hide@md">
    <h1 class="font-semibold text-2xl">Contacts</h1>
    <%= link_to "New Contact", new_contact_path, class: "btn btn--primary text-md", data: { turbo_frame: "modal" } %>
  </div>-->

  <%= render "contacts/search_form" %>

  <%= turbo_frame_tag :contacts_table do %>
    
    <%# --- DESKTOP VIEW: Table (Visible on medium screens and up) --- %>
    <div class="show@md">
      <div class="relative i-full overflow-x-auto border rounded-md bg-surface mbe-4">
        <table class="table" data-controller="check-all">
          <%# FIX: Removed duplicated <thead> tag %>
          <thead>
            <tr>
              <th><%= check_box_tag :check_all, nil, false, class: "input cursor-pointer", data: { action: "check-all#check", check_all_target: "dependee" } %></th>
              <th><%= sort_link(@search, :first_name, class: "flex items-center") %></th>
              <th><%= sort_link(@search, :last_name, class: "flex items-center") %></th>
              <th><%= sort_link(@search, :email, class: "flex items-center") %></th>
              <th><%= sort_link(@search, :phone_number, class: "flex items-center") %></th>
              <th><%= sort_link(@search, :how_we_met, class: "flex items-center") %></th>
              <th style="min-inline-size: 3rem"></th>
            </tr>
          </thead>
          <tbody id="contacts-table">
            <% if @contacts.empty? %>
              <tr><td colspan="7" class="text-center p-8">No Results.</td></tr>
            <% else %>
              <%= render @contacts %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>

    <%# --- MOBILE VIEW: Cards (Hidden on medium screens and up) --- %>
    <div class="hide@md flex flex-col" data-controller="check-all">
      <div class="flex items-center gap-half p-2">
        <%= check_box_tag "check_all_mobile", nil, false, {
              class: "input cursor-pointer",
              data: { action: "check-all#check", check_all_target: "dependee" }
            } %>
        <label for="check_all_mobile" class="font-medium cursor-pointer">Select all</label>
      </div>
      
      <div id="contacts-cards">
        <% if @contacts.empty? %>
          <p class="text-subtle text-center p-8">No contacts found.</p>
        <% else %>
          <%= render partial: "contacts/contact_card", collection: @contacts, as: :contact %>
        <% end %>
      </div>
    </div>

    <%= render "shared/pagination", pagy: @pagy %>
  <% end %>
</div>
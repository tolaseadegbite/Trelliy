<% content_for :title, "Trellixe - #{@contact.full_name}" %>

<% content_for :page_header do %>
  <div class="flex items-center justify-between i-full">
    <%# --- Breadcrumb --- %>
    <div class="text-base">
      <%= link_to "Contacts", contacts_path, class: "text-subtle hover:text-primary" %>
      <span class="text-subtle">/</span>
      <span class="text-primary overflow-ellipsis"><%= @contact.full_name %></span>
    </div>
  </div>
<% end %>

<%# --- Main Page Container: A flex container to stack sections vertically --- %>
<div class="p-4 flex flex-col gap-4">

  <%# --- SECTION 1: The two-column grid for the top content --- %>
  <div class="grid grid-cols-1 grid-cols-12@md gap-4">

    <%# --- Left Column (Profile) --- %>
    <div class="col-span-12 col-span-8@md">
      <div class="card flex justify-between h-full">
        <div class="flex items-start gap-5">
          <div class="flex shrink-0 overflow-hidden rounded-full mbs-2">
            <%= image_tag "avatar.jpg", size: "70", alt: "User Avatar", class: "border border-main rounded-full" %>
          </div>

          <div>
            <h1 class="text-3xl font-semibold mbe-2"><%= @contact.full_name %></h1>
            <h2 class="font-medium mbe-1">How We Met:</h2>
            <p class="text-sm text-subtle break-words"><%= @contact.how_we_met.presence || "No context has been added yet." %></p>
          </div>
        </div>

          <%= link_to edit_contact_path(@contact), class: "flex items-start", data: { turbo_frame: "modal" } do %>
            <span class="btn btn--icon rounded-full">
              <span class="icon icon--pen" aria-hidden="true"></span>
            </span>
          <% end %>

      </div>
    </div>

    <%# --- Right Column (Details) --- %>
    <div class="col-span-12 col-span-4@md">
      <div class="card h-full">
        <h3 class="text-xl font-semibold mbe-4">Contact Details</h3>
        <div class="flex flex-col gap text-sm">
          <div class="flex items-center gap-half">
            <span class="icon icon--mail text-subtle" aria-hidden="true"></span>
            <span class="text-primary break-all"><%= @contact.email.presence || "No email" %></span>
          </div>
          <div class="flex items-center gap-half">
            <span class="icon icon--phone text-subtle" aria-hidden="true"></span>
            <span class="text-primary whitespace-nowrap"><%= @contact.phone_number.presence || "No phone number" %></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# --- SECTION 2: The full-width Event History --- %>
  <div class="bg-surface rounded-md p-4 border">
    <h3 class="text-xl font-semibold mbe-4">Event History</h3>

    <%= render 'invitations/history_search_form', search_object: @history_search, contact: @contact %>

    <%= turbo_frame_tag "event_history_list" do %>
      <% if @invitations.any? %>
        <div class="flex flex-col gap-y-4 mbs-4">
          <% @invitations.each do |invitation| %>
            <%= render 'invitations/history_entry_with_logs', invitation: invitation %>
          <% end %>
        </div>
      <% else %>
        <p class="text-sm text-subtle text-center p-8">This contact has not been invited to any events that match your search.</p>
      <% end %>

      <%= render "shared/pagination", pagy: @pagy %>
    <% end %>
  </div>

</div>